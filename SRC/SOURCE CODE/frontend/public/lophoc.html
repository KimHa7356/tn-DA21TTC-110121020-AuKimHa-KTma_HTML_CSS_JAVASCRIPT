<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Danh sách lớp học</title>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.0/min/vs/loader.min.js"
      defer
    ></script>
    <link rel="icon" type="image/x-icon" href="/public/favicon.ico" />
    <link rel="stylesheet" href="/public/output.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
      rel="preconnect"
    />
    <style>
      body {
        background-color: #f9fafb;
        color: #1e293b;
        font-family: "Inter", sans-serif;
        margin: 0;
        padding: 0;
        overflow-x: hidden;
        overflow-y: auto;
        z-index: 1;
      }

      ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
      }

      ::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 4px;
      }

      ::-webkit-scrollbar-thumb {
        background: #888;
        border-radius: 4px;
      }

      ::-webkit-scrollbar-thumb:hover {
        background: #555;
      }

      * {
        scrollbar-width: thin;
        scrollbar-color: #888 #f1f1f1;
      }

      .hidden {
        display: none !important;
      }

      .opacity-50 {
        opacity: 0.5;
        pointer-events: none;
      }

      .sidebar {
        width: 280px;
        background: #ffffff;
        height: 100vh;
        position: fixed;
        top: 0;
        left: 0;
        padding: 2rem;
        border-right: 1px solid #e5e7eb;
        overflow-y: auto;
      }

      .sidebar .user-info {
        display: flex;
        align-items: center;
        margin-bottom: 1.5rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid #e5e7eb;
        position: relative;
      }

      .sidebar .user-info img {
        width: 48px;
        height: 48px;
        border-radius: 50%;
        margin-right: 1rem;
        object-fit: cover;
        border: 2px solid #4b6cb7;
      }

      .sidebar .user-info .edit-icon {
        position: absolute;
        top: 48px;
        right: 5px;
        background: #4b6cb7;
        border-radius: 50%;
        padding: 4px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .sidebar .user-info .edit-icon svg {
        width: 16px;
        height: 16px;
        stroke: #ffffff;
      }

      .sidebar .user-info .user-details h3 {
        font-size: 1.125rem;
        font-weight: 600;
        color: #333333;
      }

      .sidebar .user-info .user-details p {
        font-size: 0.875rem;
        color: #666666;
        font-weight: 500;
      }

      .sidebar nav ul {
        list-style: none;
        padding: 0;
      }

      .sidebar nav ul li {
        margin-bottom: 0.5rem;
      }

      .sidebar nav ul li a {
        display: flex;
        align-items: center;
        padding: 0.5rem 0.75rem;
        color: #333333;
        text-decoration: none;
        border-radius: 0.375rem;
        font-size: 0.95rem;
        background: #f0f2f5;
        transition: background-color 0.2s;
        position: relative;
      }

      .sidebar nav ul li a.active {
        background: #4b6cb7;
        color: #ffffff;
      }

      .sidebar nav ul li a svg {
        width: 1.125rem;
        height: 1.125rem;
        margin-right: 0.5rem;
        stroke: currentColor;
      }

      .info-sub-buttons,
      .class-sub-buttons,
      .exercise-sub-buttons,
      .account-sub-buttons {
        display: none;
        margin-left: 1.5rem;
        margin-top: 0.5rem;
        margin-bottom: 0.5rem;
      }

      .info-sub-buttons a,
      .class-sub-buttons a,
      .exercise-sub-buttons a,
      .account-sub-buttons a {
        display: flex;
        align-items: center;
        padding: 0.25rem 0.5rem;
        font-size: 0.85rem;
        color: #333333;
        text-decoration: none;
        background: #e0e7ff;
        border-radius: 0.25rem;
        margin-bottom: 0.5rem;
        transition: background-color 0.3s ease, color 0.3s ease;
      }

      .info-sub-buttons a:hover,
      .class-sub-buttons a:hover,
      .exercise-sub-buttons a:hover,
      .account-sub-buttons a:hover {
        background-color: #c7d2fe;
        color: #1e40af;
      }

      .info-sub-buttons a svg,
      .class-sub-buttons a svg,
      .exercise-sub-buttons a svg,
      .account-sub-buttons a svg {
        width: 1rem;
        height: 1rem;
        margin-right: 0.5rem;
        stroke: currentColor;
      }

      .main-content {
        margin-left: 280px;
        min-height: 100vh;
        padding: 1.5rem;
        padding-top: 70px;
        overflow-y: auto;
      }

      header {
        background: #4b6cb7;
        color: #ffffff;
        padding: 1rem 2rem;
        position: fixed;
        top: 0;
        left: 280px;
        right: 0;
        z-index: 40;
        display: flex;
        justify-content: space-between;
        align-items: center;
        height: 60px;
      }

      header button {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        border-radius: 0.375rem;
        font-weight: 500;
        background: rgba(255, 255, 255, 0.1);
        border: none;
        cursor: pointer;
      }

      .back-btn,
      .logout-btn {
        color: #ffffff;
      }

      #classListContainer,
      #taskListContainer {
        background-color: #ffffff;
        border: 1px solid #e5e7eb;
        border-radius: 0.75rem;
        padding: 1.5rem;
        margin-bottom: 2rem;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.03);
      }

      #classListContainer h2,
      #taskListContainer h2 {
        font-size: 2rem;
        font-weight: 600;
        color: #1e293b;
        margin-bottom: 1.5rem;
        padding-bottom: 0.25rem;
        position: relative;
      }

      #noTaskMessage,
      #noClassMessage {
        background-color: #f3f4f6;
        padding: 1rem;
        border-radius: 0.5rem;
        text-align: center;
      }

      #classListContainer h2::after,
      #taskListContainer h2::after {
        content: "";
        position: absolute;
        bottom: 0;
        left: 0;
        width: 40px;
        height: 2px;
        background: #4b6cb7;
        border-radius: 1px;
      }

      #classList,
      #taskList {
        display: grid;
        grid-template-columns: repeat(4, minmax(0, 1fr));
        gap: 1.5rem;
        padding: 1rem 0;
      }

      .class-item,
      .task-item {
        background-color: #ffffff;
        border: 1px solid #e5e7eb;
        border-radius: 0.5rem;
        padding: 1rem;
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
        min-height: 180px;
        transition: box-shadow 0.3s ease;
        box-sizing: border-box;
      }

      /* Danh sách 9 màu nền nhẹ nhàng cho lớp học */
      .class-item.color-1,
      .task-item.color-1 {
        background-color: #f0f9ff;
      }
      .class-item.color-2,
      .task-item.color-2 {
        background-color: #fefcbf;
      }
      .class-item.color-3,
      .task-item.color-3 {
        background-color: #f1f5f9;
      }
      .class-item.color-4,
      .task-item.color-4 {
        background-color: #edf2f7;
      }
      .class-item.color-5,
      .task-item.color-5 {
        background-color: #fff5f7;
      }
      .class-item.color-6,
      .task-item.color-6 {
        background-color: #e6fffa;
      }
      .class-item.color-7,
      .task-item.color-7 {
        background-color: #fef3c7;
      }
      .class-item.color-8,
      .task-item.color-8 {
        background-color: #f3e8ff;
      }
      .class-item.color-9,
      .task-item.color-9 {
        background-color: #e6fffb;
      }

      /* Màu nền cố định xanh lá nhẹ cho nhiệm vụ */
      .task-item {
        background-color: #ffffff; /* Màu mặc định, để các class color-* ghi đè */
      }

      /* Giữ nguyên màu nền khi hover với độ ưu tiên cao */
      .class-item:hover,
      .task-item:hover {
        background-color: inherit !important;
        border-color: #e5e7eb;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }

      .class-item h3,
      .task-item h3 {
        font-size: 1.5rem;
        font-weight: 500;
        color: #1e293b;
        margin: 0;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }

      .class-item p,
      .task-item p {
        font-size: 1.1rem;
        color: #4b5563;
        margin: 0;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .class-item p svg,
      .task-item p svg {
        width: 1rem;
        height: 1rem;
        stroke: #6b7280;
      }

      .class-item a,
      .task-item a {
        background-color: #4b6cb7;
        color: #ffffff;
        padding: 0.5rem 1rem;
        border-radius: 0.25rem;
        font-size: 1rem;
        font-weight: 500;
        text-align: center;
        text-decoration: none;
        margin-top: auto;
        width: fit-content;
      }

      .class-item a:hover,
      .task-item a:hover {
        background-color: #3b5ca6;
      }

      .task-item .status-completed {
        color: #16a34a;
      }

      .task-item .status-pending {
        color: #f59e0b;
      }

      .task-item .status-overdue {
        color: #ef4444;
      }

      .bg-white {
        background-color: #ffffff;
        border: 1px solid #e5e7eb;
        border-radius: 0.75rem;
        box-shadow: 0 2px 6px rgba(0, 0, 20, 0.03);
      }

      .bg-blue-600 {
        background-color: #3b82f6;
      }

      .bg-blue-600:hover {
        background-color: #2563eb;
      }

      .bg-gray-100 {
        background-color: #f3f4f6;
      }

      .text-gray-600 {
        color: #6b7280;
      }

      .text-gray-800 {
        color: #1f2937;
      }

      #errorMessage {
        transition: opacity 0.3s ease;
      }
      #errorMessage:not(.hidden) {
        opacity: 1;
      }
      #errorMessage.hidden {
        opacity: 0;
      }

      @media (max-width: 640px) {
        #classList,
        #taskList {
          grid-template-columns: 1fr;
        }

        .class-item,
        .task-item {
          min-width: 100%;
          padding: 1rem;
          min-width: 250px;
        }

        .class-item h3,
        .task-item h3 {
          font-size: 1.25rem;
        }

        .class-item p,
        .task-item p {
          font-size: 1rem;
        }

        .class-item a,
        .task-item a {
          font-size: 0.9rem;
          padding: 0.4rem 0.8rem;
        }

        .sidebar {
          width: 200px;
        }

        .main-content {
          margin-left: 200px;
        }

        header {
          left: 200px;
        }
      }

      @media (max-width: 1024px) {
        #classList,
        #taskList {
          grid-template-columns: repeat(2, minmax(0, 1fr));
        }
      }

      @media (max-width: 640px) {
        #classList,
        #taskList {
          grid-template-columns: 1fr;
        }
        .class-item,
        .task-item {
          min-width: 250px;
        }
      }
    </style>
  </head>
  <body
    class="bg-gray-100 font-['Inter',sans-serif] min-h-screen flex flex-col"
  >
    <div class="flex">
      <aside id="sidebar" class="sidebar">
        <div class="user-info">
          <img
            id="userAvatar"
            src="/images/default-avatar.png"
            alt="Ảnh đại diện người dùng"
          />
          <a
            href="/chinhsuathongtin"
            class="edit-icon"
            title="Chỉnh sửa thông tin"
            aria-label="Chỉnh sửa thông tin cá nhân"
            rel="noopener noreferrer"
          >
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M11 5H6a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"
              ></path>
            </svg>
          </a>
          <div class="user-details">
            <h3 id="userName">Tên người dùng</h3>
            <p id="userEmail">email@example.com</p>
            <p id="userRole">Vai trò: Chưa xác định</p>
          </div>
        </div>
        <nav>
          <ul>
            <li>
              <a
                href="#"
                id="viewInfoSidebar"
                class="flex items-center px-4 py-2 rounded-lg font-medium"
                style="background-color: #f0f2f5; color: #333333"
                aria-label="Xem thông tin"
              >
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                  ></path>
                </svg>
                Xem thông tin
              </a>
              <div class="info-sub-buttons" id="infoSubButtons">
                <a
                  href="/thongtin/giangvien"
                  class="subitem"
                  id="teacherInfoButton"
                  aria-label="Thông tin giảng viên"
                >
                  <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M12 4.5a2.5 2.5 0 110 5 2.5 2.5 0 010-5zM12 15c-3.313 0-6 1.343-6 3v1h12v-1c0-1.657-2.687-3-6-3z"
                    ></path>
                  </svg>
                  Giảng viên
                </a>
                <a
                  href="/thongtin/sinhvien"
                  class="subitem"
                  aria-label="Thông tin sinh viên"
                >
                  <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M12 4.5a2.5 2.5 0 110 5 2.5 2.5 0 010-5zM12 15c-3.313 0-6 1.343-6 3v1h12v-1c0-1.657-2.687-3-6-3z"
                    ></path>
                  </svg>
                  Sinh viên
                </a>
              </div>
            </li>
            <li id="manageExerciseItem">
              <a
                href="#"
                id="manageExerciseSidebar"
                class="flex items-center px-4 py-2 rounded-lg font-medium"
                style="background-color: #f0f2f5; color: #333333"
                aria-label="Quản lý bài tập"
              >
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M12 4v16m8-8H4"
                  ></path>
                </svg>
                Quản lý bài tập
              </a>
              <div class="exercise-sub-buttons" id="exerciseSubButtons">
                <a href="/taobaitap" class="subitem" aria-label="Tạo bài tập">
                  <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M12 4v16m8-8H4"
                    ></path>
                  </svg>
                  Tạo bài tập
                </a>
                <a
                  href="/danhsachbaitap"
                  class="subitem"
                  aria-label="Danh sách bài tập"
                >
                  <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"
                    ></path>
                  </svg>
                  Danh sách bài tập
                </a>
              </div>
            </li>
            <li id="manageClassItem">
              <a
                href="#"
                id="manageClassSidebar"
                class="flex items-center px-4 py-2 rounded-lg font-medium"
                style="background-color: #f0f2f5; color: #333333"
                aria-label="Quản lý lớp"
              >
                <svg
                  class="w-5 h-5"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 18"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"
                  ></path>
                </svg>
                Quản lý lớp
              </a>
              <div class="class-sub-buttons" id="classSubButtons">
                <a href="/taolophoc" class="subitem" aria-label="Tạo lớp học">
                  <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M12 4v16m8-8H4"
                    ></path>
                  </svg>
                  Tạo lớp học
                </a>
                <a
                  href="/danhsachlop"
                  class="subitem"
                  aria-label="Danh sách lớp"
                >
                  <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"
                    ></path>
                  </svg>
                  Danh sách lớp
                </a>
              </div>
            </li>

            <li>
              <a
                href="/timkiemlophoc"
                id="searchClassSidebar"
                class="flex items-center px-4 py-2 rounded-lg font-medium"
                style="background-color: #f0f2f5; color: #333333"
                aria-label="Tìm kiếm lớp học"
              >
                <svg
                  class="w-5 h-5"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
                  ></path>
                </svg>
                Tìm kiếm lớp học
              </a>
            </li>
            <li>
              <a
                href="/lophoc.html"
                id="classListSidebar"
                class="flex items-center px-4 py-2 rounded-lg font-medium"
                style="background-color: #f0f2f5; color: #333333"
              >
                <svg
                  class="w-5 h-5"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"
                  ></path>
                </svg>
                Lớp học
              </a>
            </li>

            <li id="manageAccountItem">
              <a
                href="#"
                id="manageAccountSidebar"
                class="flex items-center px-4 py-2 rounded-lg font-medium"
                style="background-color: #f0f2f5; color: #333333"
                aria-label="Quản lý tài khoản"
              >
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"
                  ></path>
                </svg>
                Quản lý tài khoản
              </a>
              <div class="account-sub-buttons" id="accountSubButtons">
                <a
                  href="/themgiangvien"
                  class="subitem"
                  id="addTeacherButton"
                  aria-label="Thêm giảng viên"
                >
                  <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M12 4.5a2.5 2.5 0 110 5 2.5 2.5 0 010-5zM12 15c-3.313 0-6 1.343-6 3v1h12v-1c0-1.657-2.687-3-6-3z"
                    ></path>
                  </svg>
                  Thêm giảng viên
                </a>
                <a
                  href="/themsinhvien"
                  class="subitem"
                  id="addStudentButton"
                  aria-label="Thêm sinh viên"
                >
                  <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M12 4.5a2.5 2.5 0 110 5 2.5 2.5 0 010-5zM12 15c-3.313 0-6 1.343-6 3v1h12v-1c0-1.657-2.687-3-6-3z"
                    ></path>
                  </svg>
                  Thêm sinh viên
                </a>
              </div>
            </li>
          </ul>
        </nav>
      </aside>

      <main id="mainContent" class="main-content flex-1">
        <header>
          <div class="flex items-center space-x-2">
            <button
              id="homeButton"
              class="back-btn"
              onclick="window.location.href='/';"
            >
              <svg
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
                style="width: 1.25rem; height: 1.25rem"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M10 19l-7-7m0 0l7-7m-7 7h18"
                ></path>
              </svg>
              Quay lại Trang chính
            </button>
          </div>
          <div class="flex items-center space-x-2">
            <span
              id="userRoleHeader"
              class="text-white font-medium hidden"
            ></span>
            <button
              id="loginButton"
              class="bg-blue-600 text-white px-4 py-2 rounded-md font-medium hover:bg-blue-700 transition flex items-center hidden"
            >
              <svg
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
                style="width: 1.25rem; height: 1.25rem"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"
                ></path>
              </svg>
              Đăng nhập
            </button>
            <button
              id="logoutButton"
              class="logout-btn bg-red-600 hover:bg-red-700"
            >
              <svg
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
                style="width: 1.25rem; height: 1.25rem"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M17 16l-4-4m0 0l-4-4m4 4H7m5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h3a3 3 0 013 3v1"
                ></path>
              </svg>
              Đăng xuất
            </button>
          </div>
        </header>
        <div class="max-w-full mx-auto px-6">
          <div
            id="classListContainer"
            class="bg-white rounded-xl shadow-md p-6 border border-gray-200 flex flex-col space-y-6"
          >
            <h2
              class="text-2xl font-semibold text-gray-800"
              style="margin-bottom: 1.5rem"
            >
              Danh sách lớp học của bạn
            </h2>
            <div
              id="classList"
              class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"
            ></div>
            <p
              id="noClassMessage"
              class="text-gray-600 bg-gray-100 p-2 rounded-md text-center hidden"
            >
              Hiện tại không có lớp học nào.
            </p>
            <div
              id="errorMessage"
              class="text-red-600 bg-red-100 p-2 rounded-md text-center hidden"
            >
              Có lỗi xảy ra khi tải danh sách lớp học.
            </div>
          </div>
          <div
            id="taskListContainer"
            class="bg-white rounded-xl shadow-md p-6 border border-gray-200 flex flex-col space-y-6 mt-8"
          >
            <h2
              class="text-2xl font-semibold text-gray-800"
              style="margin-bottom: 1.5rem"
            >
              Nhiệm vụ học tập
              <span
                class="absolute bottom-0 left-0 w-10 h-0.5 bg-blue-600 rounded"
              ></span>
            </h2>
            <div
              id="taskList"
              class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"
            ></div>
            <p
              id="noTaskMessage"
              class="text-gray-600 bg-gray-100 p-2 rounded-md text-center hidden"
            >
              Hiện tại không có nhiệm vụ học tập nào.
            </p>
          </div>
        </div>
      </main>
    </div>

    <script>
      const roleMapping = {
        admin: "QuanTri",
        giang_vien: "GiangVien",
        sinh_vien: "SinhVien",
        QuanTri: "QuanTri",
        GiangVien: "GiangVien",
        SinhVien: "SinhVien",
      };

      (function () {
        function showNotification(message) {
          const errorMessageDiv = document.getElementById("errorMessage");
          errorMessageDiv.textContent = message;
          errorMessageDiv.classList.remove("hidden");
          // Tự động ẩn sau 5 giây
          setTimeout(() => {
            errorMessageDiv.classList.add("hidden");
          }, 5000);
        }

        function formatDate(dateString) {
          const date = new Date(dateString);
          const day = String(date.getDate()).padStart(2, "0");
          const month = String(date.getMonth() + 1).padStart(2, "0");
          const year = date.getFullYear();
          const hours = String(date.getHours()).padStart(2, "0");
          const minutes = String(date.getMinutes()).padStart(2, "0");
          return `${day}/${month}/${year} ${hours}:${minutes}`;
        }

        async function refreshToken() {
          const refreshToken = localStorage.getItem("refresh_token");
          if (!refreshToken) {
            throw new Error("Không có refresh token!");
          }

          const response = await fetch("http://127.0.0.1:8000/refresh_token", {
            method: "POST",
            headers: { "Content-Type": "application/x-www-form-urlencoded" },
            body: new URLSearchParams({ refresh_token: refreshToken }),
          });

          if (!response.ok) {
            throw new Error("Làm mới token thất bại!");
          }

          const data = await response.json();
          localStorage.setItem("access_token", data.access_token);
          localStorage.setItem("refresh_token", data.refresh_token);
          return data.access_token;
        }

        async function loadClassList() {
          let allClassesResponse = null;
          let allClasses = null;
          let token = localStorage.getItem("access_token");
          const vaiTro = localStorage.getItem("vai_tro");
          const maNguoiDung = localStorage.getItem("ma_nguoi_dung");

          try {
            if (!token || !maNguoiDung) {
              throw new Error("Chưa đăng nhập! Vui lòng đăng nhập lại.");
            }

            // Lấy danh sách tất cả lớp
            allClassesResponse = await fetch(`http://127.0.0.1:8000/classes/`, {
              headers: { Authorization: `Bearer ${token}` },
              cache: "no-store",
            });

            if (allClassesResponse.status === 401) {
              token = await refreshToken();
              allClassesResponse = await fetch(
                `http://127.0.0.1:8000/classes/`,
                {
                  headers: { Authorization: `Bearer ${token}` },
                  cache: "no-store",
                }
              );
            }

            if (!allClassesResponse.ok) {
              const errorText = await allClassesResponse.text();
              throw new Error(
                `Không thể lấy danh sách lớp: ${
                  errorText || "Lỗi không xác định"
                }`
              );
            }
            allClasses = await allClassesResponse.json();

            let enrolledClasses = [];
            let errorMessages = [];

            if (vaiTro === "SinhVien" && allClasses.length > 0) {
              const enrollmentPromises = allClasses.map(async (cls) => {
                const endpointUrl = `http://127.0.0.1:8000/enrollments/${
                  cls.ma_lop
                }/${encodeURIComponent(maNguoiDung)}`;
                try {
                  const response = await fetch(endpointUrl, {
                    headers: { Authorization: `Bearer ${token}` },
                    cache: "no-store",
                  });
                  if (response.status === 404) {
                    const errorData = await response.json();
                    console.warn(
                      `Lỗi 404 cho lớp ${cls.ma_lop}: ${errorData.detail}`
                    );
                    errorMessages.push(errorData.detail);
                    return null;
                  } else if (response.status === 401) {
                    token = await refreshToken();
                    const retryResponse = await fetch(endpointUrl, {
                      headers: { Authorization: `Bearer ${token}` },
                      cache: "no-store",
                    });
                    if (retryResponse.ok) {
                      return { ...cls, enrollment: await retryResponse.json() };
                    } else {
                      const retryErrorData = await retryResponse.json();
                      console.warn(
                        `Lỗi sau khi retry cho lớp ${cls.ma_lop}: ${retryErrorData.detail}`
                      );
                      errorMessages.push(retryErrorData.detail);
                      return null;
                    }
                  } else if (!response.ok) {
                    const errorData = await response.json();
                    console.error(
                      `Lỗi cho lớp ${cls.ma_lop}: ${errorData.detail}`
                    );
                    errorMessages.push(errorData.detail);
                    return null;
                  }
                  return { ...cls, enrollment: await response.json() };
                } catch (error) {
                  console.error(
                    `Lỗi khi kiểm tra đăng ký lớp ${cls.ma_lop}:`,
                    error
                  );
                  errorMessages.push(
                    `Lỗi khi kiểm tra lớp ${cls.ma_lop}: ${error.message}`
                  );
                  return null;
                }
              });
              const enrollmentResults = await Promise.all(enrollmentPromises);
              enrolledClasses = enrollmentResults.filter(
                (item) => item !== null
              );
            } else if (vaiTro === "GiangVien" && allClasses.length > 0) {
              const endpointUrl = `http://127.0.0.1:8000/enrollments/teacher/${encodeURIComponent(
                maNguoiDung
              )}`;
              const enrollmentsResponse = await fetch(endpointUrl, {
                headers: { Authorization: `Bearer ${token}` },
                cache: "no-store",
              });
              if (enrollmentsResponse.status === 401) {
                token = await refreshToken();
                const retryResponse = await fetch(endpointUrl, {
                  headers: { Authorization: `Bearer ${token}` },
                  cache: "no-store",
                });
                if (!retryResponse.ok) {
                  const errorData = await retryResponse.json();
                  throw new Error(
                    `Không thể lấy danh sách lớp của giảng viên: ${errorData.detail}`
                  );
                }
                enrolledClasses = await retryResponse.json();
              } else if (!enrollmentsResponse.ok) {
                const errorData = await enrollmentsResponse.json();
                throw new Error(
                  `Không thể lấy danh sách lớp của giảng viên: ${errorData.detail}`
                );
              } else {
                enrolledClasses = await enrollmentsResponse.json();
              }
            }

            const classListContainer = document.getElementById("classList");
            classListContainer.innerHTML = "";

            if (enrolledClasses.length === 0) {
              document
                .getElementById("noClassMessage")
                .classList.remove("hidden");
              if (errorMessages.length > 0) {
                showNotification(
                  `Không tìm thấy lớp học. Chi tiết lỗi: ${errorMessages.join(
                    "; "
                  )}`
                );
              } else {
                showNotification("Hiện tại bạn chưa tham gia lớp học nào.");
              }
            } else {
              // Lấy tên người tạo cho từng lớp
              const classesWithTeacher = await Promise.all(
                enrolledClasses.map(async (cls) => {
                  if (cls.ma_giang_vien) {
                    const teacherResponse = await fetch(
                      `http://127.0.0.1:8000/get_teacher_name/${cls.ma_giang_vien}`,
                      {
                        headers: { Authorization: `Bearer ${token}` },
                      }
                    );
                    if (teacherResponse.ok) {
                      const teacherName = await teacherResponse.text();
                      // Loại bỏ dấu ngoặc kép và khoảng trắng không cần thiết
                      const cleanTeacherName = teacherName
                        .replace(/["']/g, "")
                        .trim();
                      return { ...cls, teacher_name: cleanTeacherName };
                    }
                  }
                  return { ...cls, teacher_name: "Chưa xác định" };
                })
              );

              classesWithTeacher.forEach((cls, index) => {
                const classElement = document.createElement("div");
                classElement.className = `class-item ${
                  [
                    "color-1",
                    "color-2",
                    "color-3",
                    "color-4",
                    "color-5",
                    "color-6",
                    "color-7",
                    "color-8",
                    "color-9",
                  ][index % 9]
                }`;
                classElement.innerHTML = `
          <h3>${cls.ten_lop || "Chưa có tên"}</h3>
          <p><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg> Mã lớp: ${
            cls.ma_lop || "Chưa có mã"
          }</p>
          <p>Người tạo: ${cls.teacher_name || "Chưa xác định"}</p>
          <p>Trạng thái: Đã tham gia</p>
          <a href="/lop/${
            cls.ma_lop
          }" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">Xem chi tiết</a>
        `;
                classListContainer.appendChild(classElement);
              });
              document.getElementById("noClassMessage").classList.add("hidden");
            }

            console.log("Enrolled classes:", enrolledClasses);
          } catch (error) {
            console.error("Lỗi tải danh sách lớp:", error);
            showNotification(
              error.message || "Lỗi khi tải danh sách lớp. Vui lòng thử lại!"
            );
            document.getElementById("classList").innerHTML = "";
            document
              .getElementById("noClassMessage")
              .classList.remove("hidden");
          }
        }

        async function loadTaskList() {
          try {
            const token = localStorage.getItem("access_token");
            const userId = localStorage.getItem("ten_dang_nhap");
            if (!token || !userId) {
              throw new Error("Chưa đăng nhập! Vui lòng đăng nhập lại.");
            }

            const taskResponse = await fetch(
              `http://127.0.0.1:8000/tasks/?ten_dang_nhap=${userId}`,
              {
                headers: { Authorization: `Bearer ${token}` },
                cache: "no-store",
              }
            );

            let tasks = [];
            if (taskResponse.status === 404) {
              tasks = []; // Xử lý 404 như danh sách rỗng
            } else if (!taskResponse.ok) {
              throw new Error(
                `Không thể lấy danh sách nhiệm vụ: ${await taskResponse.text()}`
              );
            } else {
              tasks = await taskResponse.json();
            }

            const taskListContainer = document.getElementById("taskList");
            taskListContainer.innerHTML = "";
            if (!tasks || tasks.length === 0) {
              document
                .getElementById("noTaskMessage")
                .classList.remove("hidden");
              return;
            }

            tasks.forEach((task, index) => {
              const taskElement = document.createElement("div");
              // Thêm class màu dựa trên chỉ số index (chẵn/lẻ)
              taskElement.className = `task-item ${
                index % 2 === 0 ? "color-1" : "color-2"
              }`;
              const statusClass =
                new Date(task.han_nop) < new Date()
                  ? "status-overdue"
                  : task.trang_thai_nop === "da_nop" ||
                    task.trang_thai_nop === "nop_tre"
                  ? "status-completed"
                  : "status-pending";
              taskElement.innerHTML = `
    <h3>${task.ten_bai_tap || "Chưa có tên"}</h3>
    <p><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg> Hạn nộp: ${formatDate(
      task.han_nop
    )}</p>
    <p class="${statusClass}"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg> Trạng thái: ${
                new Date(task.han_nop) < new Date()
                  ? "Quá hạn"
                  : task.trang_thai_nop === "da_nop"
                  ? "Đã nộp"
                  : task.trang_thai_nop === "nop_tre"
                  ? "Nộp trễ"
                  : "Chưa nộp"
              }</p>
    <a href="/chitietBT?ma_bai_tap=${
      task.ma_bai_tap
    }" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">Xem chi tiết</a>
  `;
              taskListContainer.appendChild(taskElement);
            });
            document.getElementById("noTaskMessage").classList.add("hidden");
          } catch (error) {
            console.error("Lỗi tải danh sách nhiệm vụ:", error);
            showNotification(
              error.message || "Lỗi khi tải danh sách nhiệm vụ!"
            );
            document.getElementById("taskList").innerHTML = "";
            document.getElementById("noTaskMessage").classList.remove("hidden");
          }
        }

        function updateUserInterface(data) {
          document.getElementById("userAvatar").src = data.anh_dai_dien
            ? `http://127.0.0.1:8000${data.anh_dai_dien}`
            : "/images/default-avatar.png";
          document.getElementById("userName").textContent =
            data.ten_dang_nhap || "Tên người dùng";
          document.getElementById("userEmail").textContent =
            data.email || "email@example.com";
          document.getElementById("userRole").textContent = `Vai trò: ${
            data.vai_tro || "Chưa xác định"
          }`;
          document.getElementById("userRoleHeader").textContent = `Vai trò: ${
            data.vai_tro || "Chưa xác định"
          }`;
          document.getElementById("userRoleHeader").classList.remove("hidden");

          if (!data.ma_nguoi_dung || isNaN(data.ma_nguoi_dung)) {
            console.error("ma_nguoi_dung không hợp lệ:", data);
            throw new Error("Dữ liệu token không chứa ma_nguoi_dung hợp lệ!");
          }
          localStorage.setItem("ma_nguoi_dung", data.ma_nguoi_dung || "");
          localStorage.setItem(
            "userAvatar",
            data.anh_dai_dien
              ? `http://127.0.0.1:8000${data.anh_dai_dien}`
              : "/images/default-avatar.png"
          );
          localStorage.setItem(
            "display_name",
            data.ten_dang_nhap || "Tên người dùng"
          );
          localStorage.setItem(
            "ten_dang_nhap",
            data.ten_dang_nhap || "email@example.com"
          );
          localStorage.setItem("email", data.email || "email@example.com");
          localStorage.setItem("vai_tro", data.vai_tro || "SinhVien");

          // Thêm kiểm tra để ẩn các nút không cần thiết với vai trò SinhVien
          if (data.vai_tro === "SinhVien") {
            document.getElementById("viewInfoSidebar").classList.add("hidden"); // Ẩn "Xem thông tin"
            document
              .getElementById("manageExerciseItem")
              .classList.add("hidden"); // Ẩn "Quản lý bài tập"
            document.getElementById("manageClassItem").classList.add("hidden"); // Ẩn "Quản lý lớp"
            document.getElementById("addTeacherButton").classList.add("hidden"); // Ẩn "Thêm giảng viên"
            document.getElementById("addStudentButton").classList.add("hidden"); // Ẩn "Thêm sinh viên"
            document
              .getElementById("manageAccountItem")
              .classList.add("hidden"); // Ẩn "Quản lý tài khoản"
            // Đảm bảo nút "Tìm kiếm lớp học" hiển thị
            document
              .getElementById("searchClassSidebar")
              .classList.remove("hidden");
            // Đảm bảo nút "Lớp học" hiển thị
            document
              .getElementById("classListSidebar")
              .classList.remove("hidden");
          } else if (data.vai_tro === "GiangVien") {
            document.getElementById("addTeacherButton").classList.add("hidden"); // Ẩn "Thêm giảng viên"
            document.getElementById("addStudentButton").classList.add("hidden"); // Ẩn "Thêm sinh viên"
          }

          const teacherInfoButton =
            document.getElementById("teacherInfoButton");
          if (teacherInfoButton && data.vai_tro === "GiangVien") {
            teacherInfoButton.classList.add("opacity-50");
          }
        }

        document
          .getElementById("logoutButton")
          .addEventListener("click", function () {
            localStorage.removeItem("access_token");
            localStorage.removeItem("refresh_token");
            localStorage.removeItem("ma_nguoi_dung");
            localStorage.removeItem("ten_dang_nhap");
            localStorage.removeItem("display_name");
            localStorage.removeItem("userAvatar");
            localStorage.removeItem("email");
            localStorage.removeItem("vai_tro");
            window.location.href = "/";
          });

        document
          .querySelector(".edit-icon")
          .addEventListener("click", function (e) {
            e.preventDefault();
            window.location.href = "/chinhsuathongtin";
          });

        function navigateWithRoleCheck(event, url, roleCheck) {
          event.preventDefault();
          const token = localStorage.getItem("access_token");
          if (!token) {
            alert("Vui lòng đăng nhập để tiếp tục!");
            window.location.href = "/";
            return;
          }
          fetch("http://127.0.0.1:8000/check_token", {
            headers: { Authorization: `Bearer ${token}` },
          })
            .then((response) => response.json())
            .then((data) => {
              if (roleCheck(data.vai_tro)) {
                window.location.href = url;
              } else {
                alert("Bạn không có quyền truy cập!");
              }
            })
            .catch((error) => {
              console.error("Lỗi kiểm tra token:", error);
              alert("Phiên đăng nhập hết hạn. Vui lòng đăng nhập lại!");
              localStorage.removeItem("access_token");
              window.location.href = "/";
            });
        }

        document.addEventListener("DOMContentLoaded", () => {
          const createExerciseLink = document.querySelector(
            '.exercise-sub-buttons a[href="/taobaitap"]'
          );
          const exerciseListLink = document.querySelector(
            '.exercise-sub-buttons a[href="/danhsachbaitap"]'
          );
          const createClassLink = document.querySelector(
            '.class-sub-buttons a[href="/taolophoc"]'
          );
          const classListLink = document.querySelector(
            '.class-sub-buttons a[href="/danhsachlop"]'
          );
          const addTeacherLink = document.querySelector(
            '.account-sub-buttons a[href="/themgiangvien"]'
          );
          const addStudentLink = document.querySelector(
            '.account-sub-buttons a[href="/themsinhvien"]'
          );
          const searchClassSidebar =
            document.getElementById("searchClassSidebar");
          const viewInfoSidebar = document.getElementById("viewInfoSidebar");
          const manageExerciseSidebar = document.getElementById(
            "manageExerciseSidebar"
          );
          const manageClassSidebar =
            document.getElementById("manageClassSidebar");
          const manageAccountSidebar = document.getElementById(
            "manageAccountSidebar"
          );
          const classListSidebar = document.getElementById("classListSidebar");

          if (viewInfoSidebar) {
            viewInfoSidebar.onclick = (e) => {
              e.preventDefault();
              const infoSubButtons = document.getElementById("infoSubButtons");
              infoSubButtons.style.display =
                infoSubButtons.style.display === "block" ? "none" : "block";
              const vaiTro = localStorage.getItem("vai_tro");
              const teacherInfoButton =
                document.getElementById("teacherInfoButton");
              if (teacherInfoButton) {
                if (vaiTro === "GiangVien") {
                  teacherInfoButton.classList.add("opacity-50");
                } else {
                  teacherInfoButton.classList.remove("opacity-50");
                }
              }
            };
          }
          if (manageExerciseSidebar) {
            manageExerciseSidebar.onclick = (e) => {
              e.preventDefault();
              const exerciseSubButtons =
                document.getElementById("exerciseSubButtons");
              exerciseSubButtons.style.display =
                exerciseSubButtons.style.display === "block" ? "none" : "block";
            };
          }
          if (manageClassSidebar) {
            manageClassSidebar.onclick = (e) => {
              e.preventDefault();
              const classSubButtons =
                document.getElementById("classSubButtons");
              classSubButtons.style.display =
                classSubButtons.style.display === "block" ? "none" : "block";
            };
          }

          if (manageAccountSidebar) {
            manageAccountSidebar.onclick = (e) => {
              e.preventDefault();
              const accountSubButtons =
                document.getElementById("accountSubButtons");
              accountSubButtons.style.display =
                accountSubButtons.style.display === "block" ? "none" : "block";
            };
          }

          if (classListSidebar) {
            classListSidebar.onclick = (e) => {
              e.preventDefault();
              window.location.href = "/lophoc.html";
            };
          }

          if (createExerciseLink) {
            createExerciseLink.onclick = (e) => {
              e.preventDefault();
              window.location.href = "/taobaitap";
            };
          }
          if (exerciseListLink) {
            exerciseListLink.onclick = (e) => {
              e.preventDefault();
              window.location.href = "/danhsachbaitap";
            };
          }
          if (createClassLink) {
            createClassLink.onclick = (e) => {
              e.preventDefault();
              window.location.href = "/taolophoc";
            };
          }
          if (classListLink) {
            classListLink.onclick = (e) => {
              e.preventDefault();
              window.location.href = "/danhsachlop";
            };
          }
          if (addTeacherLink) {
            addTeacherLink.onclick = (e) => {
              e.preventDefault();
              window.location.href = "/themgiangvien";
            };
          }
          if (addStudentLink) {
            addStudentLink.onclick = (e) => {
              e.preventDefault();
              window.location.href = "/themsinhvien";
            };
          }

          if (searchClassSidebar) {
            searchClassSidebar.onclick = (e) => {
              e.preventDefault();
              window.location.href = "/timkiemlophoc";
            };
          }

          initializePage();
          loadTaskList();
        });

        async function initializePage() {
          let token = localStorage.getItem("access_token");
          if (!token) {
            alert("Vui lòng đăng nhập để tiếp tục!");
            window.location.href = "/";
            return;
          }

          try {
            const response = await fetch("http://127.0.0.1:8000/check_token", {
              headers: { Authorization: `Bearer ${token}` },
            });

            if (!response.ok) {
              token = await refreshToken();
              localStorage.setItem("access_token", token);
              const retryResponse = await fetch(
                "http://127.0.0.1:8000/check_token",
                {
                  headers: { Authorization: `Bearer ${token}` },
                }
              );
              if (!retryResponse.ok) {
                throw new Error("Không thể xác thực token sau khi làm mới!");
              }
            }

            const data = await (response.ok ? response : retryResponse).json();
            updateUserInterface(data);

            await loadClassList();
          } catch (error) {
            console.error("Lỗi tải thông tin:", error);
            if (
              error.message.includes("token") ||
              error.message.includes("đăng nhập")
            ) {
              alert("Phiên đăng nhập hết hạn, vui lòng đăng nhập lại!");
              localStorage.removeItem("access_token");
              localStorage.removeItem("refresh_token");
              window.location.href = "/";
            } else {
              showNotification("Lỗi khi tải dữ liệu, vui lòng thử lại!");
            }
          }
        }
      })();
    </script>
  </body>
</html>
